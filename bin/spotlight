#! /usr/bin/env bash
export FD_COMMAND="fd -L --type f --no-ignore-vcs"
export FZF_DEFAULT_COMMAND="$FD_COMMAND | sed 's/^.\///'"

file=$(fzf \
    --extended \
    --multi \
    --prompt "File search: " \
    --preview="bat --color=always {}"\
    --preview-window hidden \
    --prompt "Search> " \
    --bind=change:first \
    --bind="ctrl-i:toggle-out" \
    --bind="ctrl-s:toggle-sort" \
    --bind="ctrl-d:change-prompt(Directories only> )+reload(fd -L --type d)+execute(kitty icat --clear)" \
    --bind="ctrl-f:change-prompt(Files only> )+reload(fd -L --type f)" \
    --bind="ctrl-r:change-prompt(Search> )+reload(fd -L)" \
    --bind="alt-r:execute(rm -i {})+reload($FD_COMMAND)" \
    --bind="ctrl-t:become(setsid -f dragon -x -a {+} && kill \"$$\")" \
    --bind="ctrl-space:toggle-preview" \
    --bind="alt-d:preview-down" \
    --bind="alt-u:preview-up"
)
setsid -f xdg-open "$file"
